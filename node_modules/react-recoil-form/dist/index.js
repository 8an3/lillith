"use strict";var ye=Object.create;var te=Object.defineProperty;var Ae=Object.getOwnPropertyDescriptor;var pe=Object.getOwnPropertyNames;var Ve=Object.getPrototypeOf,Fe=Object.prototype.hasOwnProperty;var ge=(e,t)=>{for(var o in t)te(e,o,{get:t[o],enumerable:!0})},ie=(e,t,o,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let l of pe(t))!Fe.call(e,l)&&l!==o&&te(e,l,{get:()=>t[l],enumerable:!(s=Ae(t,l))||s.enumerable});return e};var le=(e,t,o)=>(o=e!=null?ye(Ve(e)):{},ie(t||!e||!e.__esModule?te(o,"default",{value:e,enumerable:!0}):o,e)),xe=e=>ie(te({},"__esModule",{value:!0}),e);var Ue={};ge(Ue,{Field:()=>Ce,FormProvider:()=>me,useField:()=>se,useFieldArray:()=>Se,useFieldArrayColumnWatch:()=>fe,useFieldWatch:()=>be,useForm:()=>Pe,useFormContext:()=>we,useFormValues:()=>Re,useIsDirty:()=>Oe,withFormProvider:()=>Ee});module.exports=xe(Ue);var g=le(require("react")),v=require("recoil");var _=require("recoil");function X(e){return`WitForm_${e}`}function ne(e){let t=Math.floor(Math.random()*1e4);for(;e.indexOf(t)!==-1;)t++;return t}function de(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}function Y(e){return t=>e.getLoadable(t).contents}function ue(e,t){let o="",s=[];for(let l of e.ancestors){let d=t(O({formId:e.formId,ancestors:s,name:l.name,type:"field-array"})).rowIds.indexOf(l.rowId);o=o+`${l.name}[${d}].`,s.push(l)}return o=o+e.name,o}function D(e,t,o=void 0,s=[]){if(s!=null&&s.length){let d="";for(let a of s)d=d+`${a.name}[${a.index}].`;t=d+t}let l=d=>String.prototype.split.call(t,d).filter(Boolean).reduce((a,c)=>a!=null?a[c]:a,e),i=l(/[,[\]]+?/)||l(/[,[\].]+?/);return i===void 0||i===e?o:i}function W(e,t,o,s){if(t&&e){let l=G(o);if(s!=null&&s.length){let r="";for(let f of s)r=r+`${f.name}[${f.index}].`;t=r+t}let i=t.matchAll(/([^[.\]])+/g),d=i.next(),a="",c=e;for(;!d.done;){let r=d.value,f=i.next(),F=f.done,m=f.value;a=r[0];let I=!F&&t.charAt(m.index-1)==="[";F?c[a]=l:((c[a]===void 0||c[a]===null)&&(c[a]=I?[]:{}),c=c[a]),d=f}}return e}function B(e,t,o){if(o&&o(e,t)||e===t)return!0;if(typeof e!="object"||typeof t!="object"||e==null||t==null)return!1;let s=Object.keys(e).filter(d=>!$(e[d])),l=Object.keys(t).filter(d=>!$(t[d]));if(s.length!==l.length)return!1;let i=!0;return s.forEach(d=>{l.includes(d)||(i=!1),(typeof e[d]=="function"||typeof t[d]=="function")&&e[d].toString()!==t[d].toString()&&(i=!1),B(e[d],t[d])||(i=!1)}),i}function ve(e){return"fromEntries"in Object?Object.fromEntries(e):[...e].reduce((t,[o,s])=>(t[o]=s,t),{})}function G(e){return Array.isArray(e)?e.map(G):e===null||typeof e!="object"||e instanceof File?e:ve(Object.entries(e).map(([t,o])=>[t,G(o)]))}function $(e){return e===void 0||Number.isNaN(e)}var Z=(0,_.atomFamily)({key:X("FormValues"),default:{values:{},extraInfos:{}}}),L=(0,_.atomFamily)({key:X("FormInitialValues"),default:{values:{},version:0,extraInfos:{},settings:{skipUnregister:void 0,skipUnusedInitialValues:void 0}}}),E={},O=(0,_.atomFamily)({key:X("FormFields"),default:e=>e.type==="field"?{initVer:0,type:"field"}:{fieldNames:[],initVer:0,rowIds:[],type:"field-array"},effects_UNSTABLE:e=>[({onSet:t,node:o})=>{t(s=>{E[e.formId]||(E[e.formId]={fields:{},fieldArrays:{}});let l=E[e.formId].fields,i=E[e.formId].fieldArrays;e.type==="field"?l[o.key]={atomValue:s,param:e}:e.type==="field-array"&&(i[o.key]={atomValue:s,param:e})})}]});function ee(e,t,o,s){var d;let l=o(O({ancestors:t.ancestors,name:t.name,type:"field-array",formId:e})),i=(d=t.ancestors)!=null&&d.length?[...t.ancestors,{name:t.name,rowId:t.rowId}]:[{name:t.name,rowId:t.rowId}];for(let a of l.fieldNames)if(typeof a=="string")s(O({ancestors:i,name:a,type:"field",formId:e}));else if(a.type==="field")s(O({ancestors:i,name:a.name,type:"field",formId:e}));else{let c=o(O({ancestors:i,name:a.name,type:"field-array",formId:e}));for(let r of c.rowIds)ee(e,{ancestors:i,name:a.name,rowId:r},o,s)}}function K(e,t,o,s,l){var w,R,k,x;let i=s==null?void 0:s.isValidation,d=s==null?void 0:s.set,a=s==null?void 0:s.skipFieldCheck,{name:c}=t,r=[],f=[],F=[],m=O({ancestors:t.ancestors,name:t.name,type:"field-array",formId:e}),I=o(m),p=-1;for(let S of I.rowIds){let P=(w=t.ancestors)!=null&&w.length?[...t.ancestors,{rowId:S,name:t.name}]:[{rowId:S,name:t.name}];p++;let h=l?[...l,{name:c,rowId:S}]:[{name:c,rowId:S}];r.push({}),f.push({});let A=I.fieldNames.filter(n=>!t.fieldNames||t.fieldNames.indexOf(typeof n=="string"?n:n.name)!==-1);for(let n of A)if(typeof n=="string"){let y=O({name:n,type:"field",ancestors:P,formId:e}),u=o(y);if(i&&!a){let V=(R=u.validate)==null?void 0:R.call(u,u.data);V&&(F.push({error:V,name:n,type:"field",ancestors:h}),d==null||d(y,b=>({...b,error:V})))}W(r[p],n,u.data),W(f[p],n,u.extraInfo)}else if(n.type==="field"){let y=O({name:n.name,type:"field",ancestors:P,formId:e}),u=o(y);if(i&&!a){let V=(k=u.validate)==null?void 0:k.call(u,u.data);V&&(F.push({error:V,name:n.name,type:"field",ancestors:h}),d==null||d(y,b=>({...b,error:V})))}W(r[p],n.name,u.data),W(f[p],n.name,u.extraInfo)}else{let{data:y,extraInfo:u,errors:V}=K(e,{name:n.name,ancestors:P},o,s,h);V!=null&&V.length&&F.push(...V),$(y)||W(r[p],n.name,y),$(u)||W(f[p],n.name,u)}}if(i){let S=(x=I.validate)==null?void 0:x.call(I,r);S&&(F.push({error:S,name:c,type:"field-array",ancestors:l??[]}),d==null||d(m,P=>({...P,error:S})))}return{data:r,extraInfo:f,errors:F}}function H(e,t,o){let{get:s,set:l,reset:i,dataArr:d,extraInfoArr:a,initialValuesVersion:c,mode:r,fieldNames:f}=o;r||(r={type:"set"});let F={...t,formId:e,type:"field-array"},m=s(O(F));if(m.type!=="field-array")throw new Error("Please check the field type in field array since this seems to be a regular field but has been specified as a nested field array");let I=m.rowIds,p=(d==null?void 0:d.length)??0,w=[],R=[...I],k=0;if(!r||r.type==="set"){if(I.length>p)R=I.slice(0,p),w=I.slice(p,I.length);else if(I.length<p){let x=p-I.length;for(let S=0;S<x;S++)R.push(ne(R))}l(O(F),x=>Object.assign({},x,{rowIds:R,initVer:c??x.initVer,fieldNames:c&&(f!=null&&f.length)?f:x.fieldNames}));for(let x of w)ee(e,{...F,rowId:x},s,i)}else if(r.type==="insert"){if(R=[...I],p||(p=1),r.rowIndex!==void 0){k=r.rowIndex;for(let x=k;x<k+p;x++)R.splice(x,0,ne(R))}else{k=R.length;for(let x=0;x<p;x++)R.push(ne(R))}l(O(F),x=>Object.assign({},x,{rowIds:R,initVer:c??x.initVer}))}if(d!=null&&d.length)for(let x=k;x<k+d.length;x++){let S=d[x-k],P=a==null?void 0:a[x-k],h=R[x],A=t.ancestors.length?[...t.ancestors,{name:t.name,rowId:h}]:[{name:t.name,rowId:h}];for(let n of m.fieldNames)if(typeof n=="string"){let y=D(S,n),u=D(P,n);l(O({name:n,ancestors:A,type:"field",formId:e}),V=>Object.assign({},V,{data:y,extraInfo:u,initVer:c??V.initVer}))}else if(n.type==="field"){let y=D(S,n.name),u=D(P,n.name);l(O({name:n.name,ancestors:A,type:"field",formId:e}),V=>Object.assign({},V,{data:y,extraInfo:u,initVer:c??V.initVer}))}else if(n.type==="field-array"){let y=D(S,n.name),u=D(P,n.name);H(e,{name:n.name,ancestors:A},{get:s,set:l,dataArr:y,reset:i,extraInfoArr:u,initialValuesVersion:c,fieldNames:c?n.fieldNames:void 0,mode:r})}}}var ce=(0,_.selectorFamily)({key:X("FieldArrayColAtomValueSelector"),get:({formId:e,ancestors:t,fieldArrayName:o,fieldNames:s})=>({get:l})=>{let{data:i,extraInfo:d}=K(e,{ancestors:t??[],name:o,fieldNames:s},l);return{values:i,extraInfos:d}}}),oe=(0,_.selectorFamily)({key:X("FormFieldsSelector"),get:e=>({get:t})=>{var i;if(!(e!=null&&e.length))return{values:{},extraInfos:{}};let o={},s={},l=t(L((i=e==null?void 0:e[0])==null?void 0:i.formId));for(let d of e){let a=t(O({ancestors:d.ancestors??[],name:d.name,type:"field",formId:d.formId}));W(o,d.name,(a==null?void 0:a.data)===void 0?D((l==null?void 0:l.values)??{},d.name):a==null?void 0:a.data),W(s,d.name,(a==null?void 0:a.extraInfo)===void 0?D((l==null?void 0:l.extraInfos)??{},d.name):a==null?void 0:a.extraInfo)}return{values:o,extraInfos:s}}});function he(){let e=(0,g.useContext)(z),t=(0,v.useSetRecoilState)(Z(e)),[o,s]=(0,g.useState)({values:{},extraInfo:{}});return(0,g.useEffect)(()=>{t(o)},[o,t]),(0,v.useRecoilTransactionObserver_UNSTABLE)(({snapshot:l})=>{let d=re(e,a=>l.getLoadable(a).contents);B(d,o)||s(d)}),null}function se(e){let{ancestors:t,name:o,validate:s,validateCallback:l,defaultValue:i,depFields:d,skipUnregister:a}=e,c=(0,g.useContext)(z),r=(0,v.useRecoilValue)(L(c)),[f,F]=(0,v.useRecoilState)(O({ancestors:t??[],name:o,type:"field",formId:c})),m=(0,g.useRef)(null),I=(0,g.useRef)(null),p=(0,g.useRef)(!1),{data:w,extraInfo:R,error:k,touched:x}=f,S=(d==null?void 0:d.map(n=>typeof n=="string"?{name:n,formId:c}:{...n,formId:c}))??[],P=(0,v.useRecoilValue)(oe(S)),h=(0,v.useRecoilTransaction_UNSTABLE)(({set:n,get:y})=>()=>{let u=y(L(c)),V=O({ancestors:t??[],name:o,type:"field",formId:c});if(n(V,b=>Object.assign({},b,{validate:s,initVer:u.version})),u.values&&!(t!=null&&t.length)){let b=D(u.values,o),C=D(u.extraInfos,o);n(V,{data:b??i??void 0,error:void 0,extraInfo:C,validate:s,initVer:u.version,touched:!1,type:"field"})}},[o,i,s,t]),A=(0,v.useRecoilTransaction_UNSTABLE)(({reset:n})=>()=>{var y;!a&&!((y=r.settings)!=null&&y.skipUnregister)&&!(t!=null&&t.length)&&n(O({name:o,ancestors:t??[],type:"field",formId:c}))},[a,o,r,t]);return(0,g.useEffect)(()=>{f.initVer<r.version?h():s&&!f.validate&&!l?F(n=>Object.assign({},n,{validate:s})):l&&f.validate!==l?F(n=>Object.assign({},n,{validate:l})):f.initVer===r.version&&i!==void 0&&F(n=>n.data===void 0?Object.assign({},n,{data:i}):n)},[h,r.version,f.initVer,i,s,l,f.validate,F]),(0,g.useEffect)(()=>()=>{A()},[A]),(0,g.useEffect)(()=>{(!B(m.current,P)||!B(I.current,w)||!p.current&&x)&&(m.current=P,I.current=w,p.current=!0,F(n=>{let y=l??n.validate;return Object.assign({},n,{error:y?y(w,P):void 0})}))},[w,P,F,l,x]),{fieldValue:w,initValueVer:f.initVer,extraInfo:R,setFieldValue:(0,g.useCallback)((n,y)=>{F(u=>Object.assign({},u,{data:n,extraInfo:y}))},[F]),error:x?k:void 0,onBlur:(0,g.useCallback)(()=>F(n=>n.touched?n:Object.assign({},n,{touched:!0})),[F]),touched:x}}function be(e){let{fieldNames:t,formId:o}=e,s=(0,g.useContext)(z),l=o??s,i=(t==null?void 0:t.map(r=>typeof r=="string"?{name:r,formId:l}:{...r,formId:l}))??[],d=oe(i),{values:a,extraInfos:c}=(0,v.useRecoilValue)(d);return{values:a,extraInfos:c}}function fe(e){let{fieldArrayName:t,fieldNames:o,formId:s}=e,l=(0,g.useContext)(z),d=ce({formId:s??l,fieldArrayName:t,fieldNames:o}),{values:a,extraInfos:c}=(0,v.useRecoilValue)(d);return{values:a,extraInfos:c}}function Oe(e){let t=(0,g.useContext)(z),{values:o}=(0,v.useRecoilValue)(Z(t)),{values:s}=(0,v.useRecoilValue)(L(t)),l=e!=null&&e.preCompareUpdateFormValues?e.preCompareUpdateFormValues(G(o)):o;return!B(s,l)}function Re(){let e=(0,g.useContext)(z),{values:t}=(0,v.useRecoilValue)(Z(e));return t}function we(){let e=(0,g.useContext)(z),t=(0,v.useRecoilCallback)(({set:c,snapshot:r,reset:f})=>(F,m)=>{let I=Y(r),p=I(L(e)),w={};m.value!==void 0&&(w.data=m.value),m.extraInfo!==void 0&&(w.extraInfo=m.extraInfo);let R=typeof F=="string"?{type:"field",name:F,ancestors:[]}:F;R.type==="field"?c(O({ancestors:R.ancestors??[],name:R.name,type:R.type,formId:e}),k=>{let x=Object.assign({},k,w);return p.version>x.initVer&&(x.initVer=p.version),x}):R.type==="field-array"&&H(e,{ancestors:R.ancestors??[],name:R.name},{get:I,set:c,reset:f,dataArr:m.value,extraInfoArr:m.extraInfo})},[e]),o=(0,v.useRecoilCallback)(({snapshot:c})=>r=>{var F;let f=Y(c);if(r.type==="field"){let m=f(O({ancestors:r.ancestors??[],name:r.name,type:r.type,formId:e})),I=f(L(e)),p=m.data,w=m.extraInfo;return!((F=r.ancestors)!=null&&F.length)&&p===void 0&&m.initVer<I.version&&(p=D(I.values,r.name),w=D(I.extraInfos,r.name)),{value:p,extraInfo:w}}else if(r.type==="field-array"){let{data:m,extraInfo:I}=K(e,{ancestors:r.ancestors??[],name:r.name},f);return{value:m,extraInfo:I}}return null},[e]),s=(0,v.useRecoilCallback)(({snapshot:c})=>()=>{let r=Y(c);return re(e,r)},[e]),l=(0,v.useRecoilCallback)(({snapshot:c})=>r=>{var p;let f=Y(c),{values:F}=re(e,f),m=(p=f(L(e)))==null?void 0:p.values,I=r!=null&&r.preCompareUpdateFormValues?r.preCompareUpdateFormValues(F):F;return!B(m,I)},[e]),i=(0,v.useRecoilCallback)(({reset:c})=>r=>{for(let f of r.fieldNames)c(typeof f=="string"?O({ancestors:[],formId:e,name:f,type:"field"}):O({ancestors:f.ancestors??[],formId:e,name:f.name,type:"field"}))},[e]);function d(c){var r,f,F,m,I,p;if(e){if((f=(r=E)==null?void 0:r[e])!=null&&f.fields){for(let w of Object.values(((F=E[e])==null?void 0:F.fields)??{}))c(O(w.param));E[e].fields={}}if((I=(m=E)==null?void 0:m[e])!=null&&I.fieldArrays){for(let w of Object.values(((p=E[e])==null?void 0:p.fieldArrays)??{}))c(O(w.param));E[e].fieldArrays={}}}}let a=(0,v.useRecoilTransaction_UNSTABLE)(({set:c,get:r,reset:f})=>(F,m)=>{d(f);let I=r(L(e)),p=F??I.values,w=m??I.extraInfos;c(L(e),Object.assign({},I,{values:p,extraInfos:w,version:(I.version??0)+1})),c(Z(e),{values:p,extraInfos:w})},[e]);return{getValue:o,setValue:t,getValues:s,checkIsDirty:l,removeFields:i,resetInitialValues:a}}function Se(e){let{name:t,fieldNames:o,validate:s,skipUnregister:l,ancestors:i,defaultValue:d}=e,a=(0,g.useContext)(z),c=(0,v.useRecoilValue)(L(a)),r=(0,g.useRef)(null),[f,F]=(0,v.useRecoilState)(O({name:t,ancestors:i??[],type:"field-array",formId:a})),m=fe({fieldArrayName:t,ancestors:i??[],fieldNames:s?void 0:[]}),I=(0,v.useRecoilTransaction_UNSTABLE)(({get:A,set:n,reset:y})=>u=>{H(a,{name:t,ancestors:i??[]},{get:A,set:n,reset:y,dataArr:u})}),p=(0,v.useRecoilCallback)(({snapshot:A,set:n})=>()=>{let y=V=>A.getLoadable(V).contents,{errors:u}=K(a,{name:t,ancestors:i??[]},y,{set:n,isValidation:!0});return{errors:u,isValid:!(u!=null&&u.length)}},[t,f,a]);(0,g.useEffect)(()=>{var A;if(s&&f.initVer&&!B(m==null?void 0:m.values,(A=r.current)==null?void 0:A.values)){r.current=m;let n=s((m==null?void 0:m.values)??[]);F(y=>Object.assign({},y,{error:n}))}},[m,F,s,f.initVer]);let w=(0,v.useRecoilCallback)(({snapshot:A})=>()=>{let n=Y(A);return K(a,{name:t,ancestors:i??[]},n).data},[t,i,a]),R=(0,v.useRecoilTransaction_UNSTABLE)(({set:A,get:n,reset:y})=>u=>{let V=n(O({ancestors:i??[],name:t,type:"field-array",formId:a})),b=V.rowIds[u];if(b!==null){ee(a,{name:t,rowId:b,ancestors:i??[]},n,y);let C=[...V.rowIds];C.splice(u,1),A(O({ancestors:i??[],name:t,type:"field-array",formId:a}),N=>Object.assign({},N,{rowIds:C}))}},[t,i,a]),k=(0,v.useRecoilTransaction_UNSTABLE)(({get:A,set:n,reset:y})=>()=>{let u=A(O({name:t,ancestors:i??[],type:"field-array",formId:a})),V=u.rowIds;for(let b of V)ee(a,{name:t,rowId:b,ancestors:i??[]},A,y);n(O({name:t,ancestors:i??[],type:"field-array",formId:a}),Object.assign({},u,{rowIds:[]}))},[t,i,a]),x=(0,v.useRecoilTransaction_UNSTABLE)(({set:A,get:n,reset:y})=>(...u)=>{H(a,{name:t,ancestors:i??[]},{get:n,set:A,reset:y,dataArr:u,mode:{type:"insert"}})},[t,o,a]),S=(0,v.useRecoilTransaction_UNSTABLE)(({set:A,get:n,reset:y})=>(u,...V)=>{H(a,{name:t,ancestors:i??[]},{get:n,set:A,reset:y,dataArr:V,mode:{type:"insert",rowIndex:u}})},[f.rowIds,t,a]),P=(0,v.useRecoilTransaction_UNSTABLE)(({set:A,get:n,reset:y})=>()=>{let u=n(L(a)),V=ue({name:t,ancestors:i??[],type:"field-array",formId:a},n),b=D(u.values,V)??d,C=D(u.extraInfos,V);r.current={values:b??[],extraInfos:C??[]},A(O({name:t,ancestors:i??[],type:"field-array",formId:a}),N=>Object.assign({},N,{validate:s,fieldNames:o,initVer:u.version,skipUnregister:l})),!(i!=null&&i.length)&&(b!=null&&b.length)&&H(a,{name:t,ancestors:i??[]},{get:n,set:A,reset:y,dataArr:b,extraInfoArr:C,initialValuesVersion:u.version,skipRecursion:!0})},[t,s,o,i,l,a]),h=(0,v.useRecoilTransaction_UNSTABLE)(({reset:A,get:n})=>y=>{var N;let u=i==null?void 0:i[0];if(u&&n(O({ancestors:[],name:u.name,type:"field-array",formId:a})).skipUnregister)return;let V=O({ancestors:i??[],name:y,type:"field-array",formId:a}),C=n(V);if(!l&&!((N=c.settings)!=null&&N.skipUnregister)){for(let U of C.rowIds)ee(a,{name:y,ancestors:i??[],rowId:U},n,A);A(V)}},[l,c,a]);return(0,g.useEffect)(()=>{f.initVer<c.version&&P()},[P,c,f.initVer]),(0,g.useEffect)(()=>()=>{h(t)},[t,h]),{append:x,remove:R,fieldArrayProps:f,insert:S,validateData:p,removeAll:k,getFieldArrayValue:w,setFieldArrayValue:I,error:f==null?void 0:f.error}}var re=(e,t)=>{var a,c,r,f,F;let o=t(L(e)),s=!((a=o.settings)!=null&&a.skipUnusedInitialValues)&&o.values?G(o.values):{},l=!((c=o.settings)!=null&&c.skipUnusedInitialValues)&&o.extraInfos?G(o.extraInfos):{},i=E[e]?Object.values(((r=E[e])==null?void 0:r.fieldArrays)??{}):[];for(let m of i)(f=m.param.ancestors)!=null&&f.length||W(s,m.param.name,void 0);let d=E[e]?Object.values(((F=E[e])==null?void 0:F.fields)??{}):[];for(let m of d){let I=m.param.ancestors,p=[];if(I.length)for(let k=0;k<I.length;k++){let x=i.find(S=>{if(S.param.name===I[k].name){for(let P=0;P<k;P++)if(S.param.ancestors[P].name!==I[P].name||S.param.ancestors[P].rowId!==I[P].rowId)return!1;return!0}return!1});x&&p.push({name:x.param.name,index:x.atomValue.rowIds.findIndex(S=>I[k].rowId===S)})}let w=m.atomValue.data,R=m.atomValue.extraInfo;$(w)||W(s,m.param.name,w,p),$(R)||W(l,m.param.name,R,p)}return{values:s,extraInfos:l}};function Pe(e){let{initialValues:t,onError:o,onSubmit:s,skipUnregister:l,validate:i,skipUnusedInitialValues:d}=e,[a,c]=(0,g.useState)({isSubmitting:!1}),r=(0,g.useContext)(z),f=(0,g.useRef)(0),F=(0,g.useRef)(!1);function m(h){var A,n,y,u,V,b;if(r){if((n=(A=E)==null?void 0:A[r])!=null&&n.fields){for(let C of Object.values(((y=E[r])==null?void 0:y.fields)??{}))h(O(C.param));E[r].fields={}}if((V=(u=E)==null?void 0:u[r])!=null&&V.fieldArrays){for(let C of Object.values(((b=E[r])==null?void 0:b.fieldArrays)??{}))h(O(C.param));E[r].fieldArrays={}}}}let I=(0,v.useRecoilTransaction_UNSTABLE)(({reset:h})=>()=>{m(h)},[r]);(0,g.useEffect)(()=>(F.current=!0,()=>{F.current=!1,I()}),[I]);let p=(0,v.useRecoilTransaction_UNSTABLE)(({set:h,get:A,reset:n})=>(y,u,V)=>{var U,j;m(n);let b=A(L(r));f.current=(b.version??0)+1;let C=y??b.values,N=V??b.extraInfos;h(L(r),Object.assign({},b,{values:C,extraInfos:N,version:((b==null?void 0:b.version)??0)+1,settings:{skipUnregister:(u==null?void 0:u.skipUnregister)??((U=b.settings)==null?void 0:U.skipUnregister),skipUnusedInitialValues:(u==null?void 0:u.skipUnusedInitialValues)??((j=b.settings)==null?void 0:j.skipUnusedInitialValues)}})),h(Z(r),{values:C,extraInfos:N})},[r]),w=(0,g.useCallback)((h,A)=>{p(h,void 0,A)},[p]);(0,g.useEffect)(()=>{f.current||p(t??{},{skipUnregister:l,skipUnusedInitialValues:d},void 0)},[p,l,d,t]);let R=(0,v.useRecoilCallback)(({snapshot:h})=>()=>re(r,n=>h.getLoadable(n).contents),[]),k=(0,v.useRecoilCallback)(({set:h,snapshot:A})=>n=>{var C,N;let y=R(),u=[],V=U=>A.getLoadable(U).contents,b=Object.values(((C=E[r])==null?void 0:C.fieldArrays)??{});if(n!=null&&n.length)for(let U of n){let j=null;if(typeof U=="string"?b.find(M=>M.param.name===U&&!M.param.ancestors.length)?j={name:U,ancestors:[],type:"field-array"}:j={name:U,ancestors:[],type:"field"}:j=U,j.type==="field"){let T=j.name,M=j.ancestors??[],J=O({name:T,type:"field",ancestors:M??[],formId:r}),Q=V(J),ae=(N=Q.validate)==null?void 0:N.call(Q,Q.data,y);ae&&(h(J,Ie=>Object.assign({},Ie,{error:ae,touched:!0})),u.push({error:ae,ancestors:M??[],name:T,type:"field"}))}else{let{errors:T}=K(r,{ancestors:j.ancestors??[],name:j.name},V,{isValidation:!0,set:h});if(T!=null&&T.length){u.push(...T);for(let M of T)if(M.type==="field"){let J=O({name:M.name,type:"field",ancestors:M.ancestors??[],formId:r});h(J,Q=>Object.assign({},Q,{error:M.error,touched:!0}))}}}}return u},[r]),x=(0,v.useRecoilCallback)(({snapshot:h,set:A})=>(n,y)=>{var b,C,N;let u=U=>h.getLoadable(U).contents,V=[];for(let U of Object.values(((b=E[r])==null?void 0:b.fields)??{})){let j=O(U.param),T=u(j),M=(C=T.validate)==null?void 0:C.call(T,T.data,{values:n,extraInfos:y});M&&(A(j,J=>Object.assign({},J,{error:M,touched:!0})),V.push({error:M,ancestors:U.param.ancestors,name:U.param.name,type:"field"}))}for(let U of Object.values(((N=E[r])==null?void 0:N.fieldArrays)??{})){let{errors:j}=K(r,U.param,u,{isValidation:!0,set:A,skipFieldCheck:!0});j!=null&&j.length&&V.push(...j)}return V},[r]),S=(0,g.useCallback)(h=>{h&&h.preventDefault&&h.preventDefault(),h&&h.stopPropagation&&h.stopPropagation();let{values:A,extraInfos:n}=R(),y=x(A,n),u=i==null?void 0:i(A);if(y.length||u!=null&&u.length){o&&o(y,u,A);return}c({isSubmitting:!0});let V=s==null?void 0:s(A,n);return V&&V.then?V.then(b=>{F.current&&(b!==!1&&p(e!=null&&e.reinitializeOnSubmit?t??{}:A,{skipUnregister:l,skipUnusedInitialValues:d},e!=null&&e.reinitializeOnSubmit?{}:n),c({isSubmitting:!1}))}).catch(()=>{F&&c({isSubmitting:!1})}):(c({isSubmitting:!1}),p(e!=null&&e.reinitializeOnSubmit?t??{}:A,{skipUnregister:l,skipUnusedInitialValues:d},e!=null&&e.reinitializeOnSubmit?{}:n),V)},[x,s,o,i,p,l,r,R]),P=(0,g.useCallback)(()=>{let{values:h,extraInfos:A}=R();return x(h,A)},[R,x]);return{handleSubmit:S,formState:a,handleReset:I,resetInitialValues:w,validateFields:k,validateAllFields:P,getValues:R}}function ke(e){return g.default.createElement(g.Fragment,null,e.children)}var z=g.default.createContext("");function me(e){var o,s,l;let t=(0,g.useRef)(((o=e==null?void 0:e.options)==null?void 0:o.formId)??de());return(0,g.useEffect)(()=>{let i=t.current;return()=>{delete E[i]}},[]),g.default.createElement(v.RecoilRoot,{override:!((s=e.options)!=null&&s.skipRecoilRoot)},g.default.createElement(z.Provider,{value:t.current},(l=e.options)!=null&&l.skipValuesObserver?null:g.default.createElement(he,null),g.default.createElement(ke,{...e})))}var Ee=(e,t)=>({...o})=>g.default.createElement(me,{options:t},g.default.createElement(e,{...o}));var q=le(require("react"));var Ce=e=>{let{children:t,name:o,required:s,handleChange:l,defaultValue:i,ancestors:d,validate:a}=e,{fieldValue:c,setFieldValue:r,error:f}=se({name:o,ancestors:d,defaultValue:i,validate:a||(m=>s&&!m?"Required":null)}),F={value:c??"",onChange:m=>{var p;let I=(p=m==null?void 0:m.target)==null?void 0:p.value;r(I),l==null||l(I)},error:f};if(typeof t=="function")return q.default.createElement(q.default.Fragment,null,t({value:c??"",onChange:r,error:f}));{let m=q.default.Children.map(t,I=>q.default.isValidElement(I)?q.default.cloneElement(I,F):I);return q.default.createElement(q.default.Fragment,null,m)}};0&&(module.exports={Field,FormProvider,useField,useFieldArray,useFieldArrayColumnWatch,useFieldWatch,useForm,useFormContext,useFormValues,useIsDirty,withFormProvider});
