import _,{useCallback as oe,useEffect as z,useState as ye,Fragment as ge,useRef as X,useContext as B}from"react";import{RecoilRoot as xe,useRecoilTransaction_UNSTABLE as M,useRecoilState as Ae,useRecoilTransactionObserver_UNSTABLE as ve,useRecoilValue as H,useSetRecoilState as he,useRecoilCallback as W}from"recoil";import{atomFamily as de,selectorFamily as me}from"recoil";function te(e){return`WitForm_${e}`}function se(e){let t=Math.floor(Math.random()*1e4);for(;e.indexOf(t)!==-1;)t++;return t}function ce(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}function ne(e){return t=>e.getLoadable(t).contents}function fe(e,t){let l="",s=[];for(let u of e.ancestors){let i=t(h({formId:e.formId,ancestors:s,name:u.name,type:"field-array"})).rowIds.indexOf(u.rowId);l=l+`${u.name}[${i}].`,s.push(u)}return l=l+e.name,l}function U(e,t,l=void 0,s=[]){if(s!=null&&s.length){let i="";for(let a of s)i=i+`${a.name}[${a.index}].`;t=i+t}let u=i=>String.prototype.split.call(t,i).filter(Boolean).reduce((a,c)=>a!=null?a[c]:a,e),o=u(/[,[\]]+?/)||u(/[,[\].]+?/);return o===void 0||o===e?l:o}function T(e,t,l,s){if(t&&e){let u=J(l);if(s!=null&&s.length){let r="";for(let f of s)r=r+`${f.name}[${f.index}].`;t=r+t}let o=t.matchAll(/([^[.\]])+/g),i=o.next(),a="",c=e;for(;!i.done;){let r=i.value,f=o.next(),F=f.done,m=f.value;a=r[0];let I=!F&&t.charAt(m.index-1)==="[";F?c[a]=u:((c[a]===void 0||c[a]===null)&&(c[a]=I?[]:{}),c=c[a]),i=f}}return e}function q(e,t,l){if(l&&l(e,t)||e===t)return!0;if(typeof e!="object"||typeof t!="object"||e==null||t==null)return!1;let s=Object.keys(e).filter(i=>!K(e[i])),u=Object.keys(t).filter(i=>!K(t[i]));if(s.length!==u.length)return!1;let o=!0;return s.forEach(i=>{u.includes(i)||(o=!1),(typeof e[i]=="function"||typeof t[i]=="function")&&e[i].toString()!==t[i].toString()&&(o=!1),q(e[i],t[i])||(o=!1)}),o}function Fe(e){return"fromEntries"in Object?Object.fromEntries(e):[...e].reduce((t,[l,s])=>(t[l]=s,t),{})}function J(e){return Array.isArray(e)?e.map(J):e===null||typeof e!="object"||e instanceof File?e:Fe(Object.entries(e).map(([t,l])=>[t,J(l)]))}function K(e){return e===void 0||Number.isNaN(e)}var re=de({key:te("FormValues"),default:{values:{},extraInfos:{}}}),D=de({key:te("FormInitialValues"),default:{values:{},version:0,extraInfos:{},settings:{skipUnregister:void 0,skipUnusedInitialValues:void 0}}}),P={},h=de({key:te("FormFields"),default:e=>e.type==="field"?{initVer:0,type:"field"}:{fieldNames:[],initVer:0,rowIds:[],type:"field-array"},effects_UNSTABLE:e=>[({onSet:t,node:l})=>{t(s=>{P[e.formId]||(P[e.formId]={fields:{},fieldArrays:{}});let u=P[e.formId].fields,o=P[e.formId].fieldArrays;e.type==="field"?u[l.key]={atomValue:s,param:e}:e.type==="field-array"&&(o[l.key]={atomValue:s,param:e})})}]});function ae(e,t,l,s){var i;let u=l(h({ancestors:t.ancestors,name:t.name,type:"field-array",formId:e})),o=(i=t.ancestors)!=null&&i.length?[...t.ancestors,{name:t.name,rowId:t.rowId}]:[{name:t.name,rowId:t.rowId}];for(let a of u.fieldNames)if(typeof a=="string")s(h({ancestors:o,name:a,type:"field",formId:e}));else if(a.type==="field")s(h({ancestors:o,name:a.name,type:"field",formId:e}));else{let c=l(h({ancestors:o,name:a.name,type:"field-array",formId:e}));for(let r of c.rowIds)ae(e,{ancestors:o,name:a.name,rowId:r},l,s)}}function G(e,t,l,s,u){var O,b,S,g;let o=s==null?void 0:s.isValidation,i=s==null?void 0:s.set,a=s==null?void 0:s.skipFieldCheck,{name:c}=t,r=[],f=[],F=[],m=h({ancestors:t.ancestors,name:t.name,type:"field-array",formId:e}),I=l(m),p=-1;for(let R of I.rowIds){let w=(O=t.ancestors)!=null&&O.length?[...t.ancestors,{rowId:R,name:t.name}]:[{rowId:R,name:t.name}];p++;let x=u?[...u,{name:c,rowId:R}]:[{name:c,rowId:R}];r.push({}),f.push({});let A=I.fieldNames.filter(n=>!t.fieldNames||t.fieldNames.indexOf(typeof n=="string"?n:n.name)!==-1);for(let n of A)if(typeof n=="string"){let y=h({name:n,type:"field",ancestors:w,formId:e}),d=l(y);if(o&&!a){let V=(b=d.validate)==null?void 0:b.call(d,d.data);V&&(F.push({error:V,name:n,type:"field",ancestors:x}),i==null||i(y,v=>({...v,error:V})))}T(r[p],n,d.data),T(f[p],n,d.extraInfo)}else if(n.type==="field"){let y=h({name:n.name,type:"field",ancestors:w,formId:e}),d=l(y);if(o&&!a){let V=(S=d.validate)==null?void 0:S.call(d,d.data);V&&(F.push({error:V,name:n.name,type:"field",ancestors:x}),i==null||i(y,v=>({...v,error:V})))}T(r[p],n.name,d.data),T(f[p],n.name,d.extraInfo)}else{let{data:y,extraInfo:d,errors:V}=G(e,{name:n.name,ancestors:w},l,s,x);V!=null&&V.length&&F.push(...V),K(y)||T(r[p],n.name,y),K(d)||T(f[p],n.name,d)}}if(o){let R=(g=I.validate)==null?void 0:g.call(I,r);R&&(F.push({error:R,name:c,type:"field-array",ancestors:u??[]}),i==null||i(m,w=>({...w,error:R})))}return{data:r,extraInfo:f,errors:F}}function Q(e,t,l){let{get:s,set:u,reset:o,dataArr:i,extraInfoArr:a,initialValuesVersion:c,mode:r,fieldNames:f}=l;r||(r={type:"set"});let F={...t,formId:e,type:"field-array"},m=s(h(F));if(m.type!=="field-array")throw new Error("Please check the field type in field array since this seems to be a regular field but has been specified as a nested field array");let I=m.rowIds,p=(i==null?void 0:i.length)??0,O=[],b=[...I],S=0;if(!r||r.type==="set"){if(I.length>p)b=I.slice(0,p),O=I.slice(p,I.length);else if(I.length<p){let g=p-I.length;for(let R=0;R<g;R++)b.push(se(b))}u(h(F),g=>Object.assign({},g,{rowIds:b,initVer:c??g.initVer,fieldNames:c&&(f!=null&&f.length)?f:g.fieldNames}));for(let g of O)ae(e,{...F,rowId:g},s,o)}else if(r.type==="insert"){if(b=[...I],p||(p=1),r.rowIndex!==void 0){S=r.rowIndex;for(let g=S;g<S+p;g++)b.splice(g,0,se(b))}else{S=b.length;for(let g=0;g<p;g++)b.push(se(b))}u(h(F),g=>Object.assign({},g,{rowIds:b,initVer:c??g.initVer}))}if(i!=null&&i.length)for(let g=S;g<S+i.length;g++){let R=i[g-S],w=a==null?void 0:a[g-S],x=b[g],A=t.ancestors.length?[...t.ancestors,{name:t.name,rowId:x}]:[{name:t.name,rowId:x}];for(let n of m.fieldNames)if(typeof n=="string"){let y=U(R,n),d=U(w,n);u(h({name:n,ancestors:A,type:"field",formId:e}),V=>Object.assign({},V,{data:y,extraInfo:d,initVer:c??V.initVer}))}else if(n.type==="field"){let y=U(R,n.name),d=U(w,n.name);u(h({name:n.name,ancestors:A,type:"field",formId:e}),V=>Object.assign({},V,{data:y,extraInfo:d,initVer:c??V.initVer}))}else if(n.type==="field-array"){let y=U(R,n.name),d=U(w,n.name);Q(e,{name:n.name,ancestors:A},{get:s,set:u,dataArr:y,reset:o,extraInfoArr:d,initialValuesVersion:c,fieldNames:c?n.fieldNames:void 0,mode:r})}}}var Ie=me({key:te("FieldArrayColAtomValueSelector"),get:({formId:e,ancestors:t,fieldArrayName:l,fieldNames:s})=>({get:u})=>{let{data:o,extraInfo:i}=G(e,{ancestors:t??[],name:l,fieldNames:s},u);return{values:o,extraInfos:i}}}),ue=me({key:te("FormFieldsSelector"),get:e=>({get:t})=>{var o;if(!(e!=null&&e.length))return{values:{},extraInfos:{}};let l={},s={},u=t(D((o=e==null?void 0:e[0])==null?void 0:o.formId));for(let i of e){let a=t(h({ancestors:i.ancestors??[],name:i.name,type:"field",formId:i.formId}));T(l,i.name,(a==null?void 0:a.data)===void 0?U((u==null?void 0:u.values)??{},i.name):a==null?void 0:a.data),T(s,i.name,(a==null?void 0:a.extraInfo)===void 0?U((u==null?void 0:u.extraInfos)??{},i.name):a==null?void 0:a.extraInfo)}return{values:l,extraInfos:s}}});function be(){let e=B($),t=he(re(e)),[l,s]=ye({values:{},extraInfo:{}});return z(()=>{t(l)},[l,t]),ve(({snapshot:u})=>{let i=ie(e,a=>u.getLoadable(a).contents);q(i,l)||s(i)}),null}function pe(e){let{ancestors:t,name:l,validate:s,validateCallback:u,defaultValue:o,depFields:i,skipUnregister:a}=e,c=B($),r=H(D(c)),[f,F]=Ae(h({ancestors:t??[],name:l,type:"field",formId:c})),m=X(null),I=X(null),p=X(!1),{data:O,extraInfo:b,error:S,touched:g}=f,R=(i==null?void 0:i.map(n=>typeof n=="string"?{name:n,formId:c}:{...n,formId:c}))??[],w=H(ue(R)),x=M(({set:n,get:y})=>()=>{let d=y(D(c)),V=h({ancestors:t??[],name:l,type:"field",formId:c});if(n(V,v=>Object.assign({},v,{validate:s,initVer:d.version})),d.values&&!(t!=null&&t.length)){let v=U(d.values,l),k=U(d.extraInfos,l);n(V,{data:v??o??void 0,error:void 0,extraInfo:k,validate:s,initVer:d.version,touched:!1,type:"field"})}},[l,o,s,t]),A=M(({reset:n})=>()=>{var y;!a&&!((y=r.settings)!=null&&y.skipUnregister)&&!(t!=null&&t.length)&&n(h({name:l,ancestors:t??[],type:"field",formId:c}))},[a,l,r,t]);return z(()=>{f.initVer<r.version?x():s&&!f.validate&&!u?F(n=>Object.assign({},n,{validate:s})):u&&f.validate!==u?F(n=>Object.assign({},n,{validate:u})):f.initVer===r.version&&o!==void 0&&F(n=>n.data===void 0?Object.assign({},n,{data:o}):n)},[x,r.version,f.initVer,o,s,u,f.validate,F]),z(()=>()=>{A()},[A]),z(()=>{(!q(m.current,w)||!q(I.current,O)||!p.current&&g)&&(m.current=w,I.current=O,p.current=!0,F(n=>{let y=u??n.validate;return Object.assign({},n,{error:y?y(O,w):void 0})}))},[O,w,F,u,g]),{fieldValue:O,initValueVer:f.initVer,extraInfo:b,setFieldValue:oe((n,y)=>{F(d=>Object.assign({},d,{data:n,extraInfo:y}))},[F]),error:g?S:void 0,onBlur:oe(()=>F(n=>n.touched?n:Object.assign({},n,{touched:!0})),[F]),touched:g}}function Ke(e){let{fieldNames:t,formId:l}=e,s=B($),u=l??s,o=(t==null?void 0:t.map(r=>typeof r=="string"?{name:r,formId:u}:{...r,formId:u}))??[],i=ue(o),{values:a,extraInfos:c}=H(i);return{values:a,extraInfos:c}}function Oe(e){let{fieldArrayName:t,fieldNames:l,formId:s}=e,u=B($),i=Ie({formId:s??u,fieldArrayName:t,fieldNames:l}),{values:a,extraInfos:c}=H(i);return{values:a,extraInfos:c}}function qe(e){let t=B($),{values:l}=H(re(t)),{values:s}=H(D(t)),u=e!=null&&e.preCompareUpdateFormValues?e.preCompareUpdateFormValues(J(l)):l;return!q(s,u)}function Ge(){let e=B($),{values:t}=H(re(e));return t}function _e(){let e=B($),t=W(({set:c,snapshot:r,reset:f})=>(F,m)=>{let I=ne(r),p=I(D(e)),O={};m.value!==void 0&&(O.data=m.value),m.extraInfo!==void 0&&(O.extraInfo=m.extraInfo);let b=typeof F=="string"?{type:"field",name:F,ancestors:[]}:F;b.type==="field"?c(h({ancestors:b.ancestors??[],name:b.name,type:b.type,formId:e}),S=>{let g=Object.assign({},S,O);return p.version>g.initVer&&(g.initVer=p.version),g}):b.type==="field-array"&&Q(e,{ancestors:b.ancestors??[],name:b.name},{get:I,set:c,reset:f,dataArr:m.value,extraInfoArr:m.extraInfo})},[e]),l=W(({snapshot:c})=>r=>{var F;let f=ne(c);if(r.type==="field"){let m=f(h({ancestors:r.ancestors??[],name:r.name,type:r.type,formId:e})),I=f(D(e)),p=m.data,O=m.extraInfo;return!((F=r.ancestors)!=null&&F.length)&&p===void 0&&m.initVer<I.version&&(p=U(I.values,r.name),O=U(I.extraInfos,r.name)),{value:p,extraInfo:O}}else if(r.type==="field-array"){let{data:m,extraInfo:I}=G(e,{ancestors:r.ancestors??[],name:r.name},f);return{value:m,extraInfo:I}}return null},[e]),s=W(({snapshot:c})=>()=>{let r=ne(c);return ie(e,r)},[e]),u=W(({snapshot:c})=>r=>{var p;let f=ne(c),{values:F}=ie(e,f),m=(p=f(D(e)))==null?void 0:p.values,I=r!=null&&r.preCompareUpdateFormValues?r.preCompareUpdateFormValues(F):F;return!q(m,I)},[e]),o=W(({reset:c})=>r=>{for(let f of r.fieldNames)c(typeof f=="string"?h({ancestors:[],formId:e,name:f,type:"field"}):h({ancestors:f.ancestors??[],formId:e,name:f.name,type:"field"}))},[e]);function i(c){var r,f,F,m,I,p;if(e){if((f=(r=P)==null?void 0:r[e])!=null&&f.fields){for(let O of Object.values(((F=P[e])==null?void 0:F.fields)??{}))c(h(O.param));P[e].fields={}}if((I=(m=P)==null?void 0:m[e])!=null&&I.fieldArrays){for(let O of Object.values(((p=P[e])==null?void 0:p.fieldArrays)??{}))c(h(O.param));P[e].fieldArrays={}}}}let a=M(({set:c,get:r,reset:f})=>(F,m)=>{i(f);let I=r(D(e)),p=F??I.values,O=m??I.extraInfos;c(D(e),Object.assign({},I,{values:p,extraInfos:O,version:(I.version??0)+1})),c(re(e),{values:p,extraInfos:O})},[e]);return{getValue:l,setValue:t,getValues:s,checkIsDirty:u,removeFields:o,resetInitialValues:a}}function He(e){let{name:t,fieldNames:l,validate:s,skipUnregister:u,ancestors:o,defaultValue:i}=e,a=B($),c=H(D(a)),r=X(null),[f,F]=Ae(h({name:t,ancestors:o??[],type:"field-array",formId:a})),m=Oe({fieldArrayName:t,ancestors:o??[],fieldNames:s?void 0:[]}),I=M(({get:A,set:n,reset:y})=>d=>{Q(a,{name:t,ancestors:o??[]},{get:A,set:n,reset:y,dataArr:d})}),p=W(({snapshot:A,set:n})=>()=>{let y=V=>A.getLoadable(V).contents,{errors:d}=G(a,{name:t,ancestors:o??[]},y,{set:n,isValidation:!0});return{errors:d,isValid:!(d!=null&&d.length)}},[t,f,a]);z(()=>{var A;if(s&&f.initVer&&!q(m==null?void 0:m.values,(A=r.current)==null?void 0:A.values)){r.current=m;let n=s((m==null?void 0:m.values)??[]);F(y=>Object.assign({},y,{error:n}))}},[m,F,s,f.initVer]);let O=W(({snapshot:A})=>()=>{let n=ne(A);return G(a,{name:t,ancestors:o??[]},n).data},[t,o,a]),b=M(({set:A,get:n,reset:y})=>d=>{let V=n(h({ancestors:o??[],name:t,type:"field-array",formId:a})),v=V.rowIds[d];if(v!==null){ae(a,{name:t,rowId:v,ancestors:o??[]},n,y);let k=[...V.rowIds];k.splice(d,1),A(h({ancestors:o??[],name:t,type:"field-array",formId:a}),j=>Object.assign({},j,{rowIds:k}))}},[t,o,a]),S=M(({get:A,set:n,reset:y})=>()=>{let d=A(h({name:t,ancestors:o??[],type:"field-array",formId:a})),V=d.rowIds;for(let v of V)ae(a,{name:t,rowId:v,ancestors:o??[]},A,y);n(h({name:t,ancestors:o??[],type:"field-array",formId:a}),Object.assign({},d,{rowIds:[]}))},[t,o,a]),g=M(({set:A,get:n,reset:y})=>(...d)=>{Q(a,{name:t,ancestors:o??[]},{get:n,set:A,reset:y,dataArr:d,mode:{type:"insert"}})},[t,l,a]),R=M(({set:A,get:n,reset:y})=>(d,...V)=>{Q(a,{name:t,ancestors:o??[]},{get:n,set:A,reset:y,dataArr:V,mode:{type:"insert",rowIndex:d}})},[f.rowIds,t,a]),w=M(({set:A,get:n,reset:y})=>()=>{let d=n(D(a)),V=fe({name:t,ancestors:o??[],type:"field-array",formId:a},n),v=U(d.values,V)??i,k=U(d.extraInfos,V);r.current={values:v??[],extraInfos:k??[]},A(h({name:t,ancestors:o??[],type:"field-array",formId:a}),j=>Object.assign({},j,{validate:s,fieldNames:l,initVer:d.version,skipUnregister:u})),!(o!=null&&o.length)&&(v!=null&&v.length)&&Q(a,{name:t,ancestors:o??[]},{get:n,set:A,reset:y,dataArr:v,extraInfoArr:k,initialValuesVersion:d.version,skipRecursion:!0})},[t,s,l,o,u,a]),x=M(({reset:A,get:n})=>y=>{var j;let d=o==null?void 0:o[0];if(d&&n(h({ancestors:[],name:d.name,type:"field-array",formId:a})).skipUnregister)return;let V=h({ancestors:o??[],name:y,type:"field-array",formId:a}),k=n(V);if(!u&&!((j=c.settings)!=null&&j.skipUnregister)){for(let E of k.rowIds)ae(a,{name:y,ancestors:o??[],rowId:E},n,A);A(V)}},[u,c,a]);return z(()=>{f.initVer<c.version&&w()},[w,c,f.initVer]),z(()=>()=>{x(t)},[t,x]),{append:g,remove:b,fieldArrayProps:f,insert:R,validateData:p,removeAll:S,getFieldArrayValue:O,setFieldArrayValue:I,error:f==null?void 0:f.error}}var ie=(e,t)=>{var a,c,r,f,F;let l=t(D(e)),s=!((a=l.settings)!=null&&a.skipUnusedInitialValues)&&l.values?J(l.values):{},u=!((c=l.settings)!=null&&c.skipUnusedInitialValues)&&l.extraInfos?J(l.extraInfos):{},o=P[e]?Object.values(((r=P[e])==null?void 0:r.fieldArrays)??{}):[];for(let m of o)(f=m.param.ancestors)!=null&&f.length||T(s,m.param.name,void 0);let i=P[e]?Object.values(((F=P[e])==null?void 0:F.fields)??{}):[];for(let m of i){let I=m.param.ancestors,p=[];if(I.length)for(let S=0;S<I.length;S++){let g=o.find(R=>{if(R.param.name===I[S].name){for(let w=0;w<S;w++)if(R.param.ancestors[w].name!==I[w].name||R.param.ancestors[w].rowId!==I[w].rowId)return!1;return!0}return!1});g&&p.push({name:g.param.name,index:g.atomValue.rowIds.findIndex(R=>I[S].rowId===R)})}let O=m.atomValue.data,b=m.atomValue.extraInfo;K(O)||T(s,m.param.name,O,p),K(b)||T(u,m.param.name,b,p)}return{values:s,extraInfos:u}};function Je(e){let{initialValues:t,onError:l,onSubmit:s,skipUnregister:u,validate:o,skipUnusedInitialValues:i}=e,[a,c]=ye({isSubmitting:!1}),r=B($),f=X(0),F=X(!1);function m(x){var A,n,y,d,V,v;if(r){if((n=(A=P)==null?void 0:A[r])!=null&&n.fields){for(let k of Object.values(((y=P[r])==null?void 0:y.fields)??{}))x(h(k.param));P[r].fields={}}if((V=(d=P)==null?void 0:d[r])!=null&&V.fieldArrays){for(let k of Object.values(((v=P[r])==null?void 0:v.fieldArrays)??{}))x(h(k.param));P[r].fieldArrays={}}}}let I=M(({reset:x})=>()=>{m(x)},[r]);z(()=>(F.current=!0,()=>{F.current=!1,I()}),[I]);let p=M(({set:x,get:A,reset:n})=>(y,d,V)=>{var E,C;m(n);let v=A(D(r));f.current=(v.version??0)+1;let k=y??v.values,j=V??v.extraInfos;x(D(r),Object.assign({},v,{values:k,extraInfos:j,version:((v==null?void 0:v.version)??0)+1,settings:{skipUnregister:(d==null?void 0:d.skipUnregister)??((E=v.settings)==null?void 0:E.skipUnregister),skipUnusedInitialValues:(d==null?void 0:d.skipUnusedInitialValues)??((C=v.settings)==null?void 0:C.skipUnusedInitialValues)}})),x(re(r),{values:k,extraInfos:j})},[r]),O=oe((x,A)=>{p(x,void 0,A)},[p]);z(()=>{f.current||p(t??{},{skipUnregister:u,skipUnusedInitialValues:i},void 0)},[p,u,i,t]);let b=W(({snapshot:x})=>()=>ie(r,n=>x.getLoadable(n).contents),[]),S=W(({set:x,snapshot:A})=>n=>{var k,j;let y=b(),d=[],V=E=>A.getLoadable(E).contents,v=Object.values(((k=P[r])==null?void 0:k.fieldArrays)??{});if(n!=null&&n.length)for(let E of n){let C=null;if(typeof E=="string"?v.find(L=>L.param.name===E&&!L.param.ancestors.length)?C={name:E,ancestors:[],type:"field-array"}:C={name:E,ancestors:[],type:"field"}:C=E,C.type==="field"){let N=C.name,L=C.ancestors??[],Z=h({name:N,type:"field",ancestors:L??[],formId:r}),ee=V(Z),le=(j=ee.validate)==null?void 0:j.call(ee,ee.data,y);le&&(x(Z,Ve=>Object.assign({},Ve,{error:le,touched:!0})),d.push({error:le,ancestors:L??[],name:N,type:"field"}))}else{let{errors:N}=G(r,{ancestors:C.ancestors??[],name:C.name},V,{isValidation:!0,set:x});if(N!=null&&N.length){d.push(...N);for(let L of N)if(L.type==="field"){let Z=h({name:L.name,type:"field",ancestors:L.ancestors??[],formId:r});x(Z,ee=>Object.assign({},ee,{error:L.error,touched:!0}))}}}}return d},[r]),g=W(({snapshot:x,set:A})=>(n,y)=>{var v,k,j;let d=E=>x.getLoadable(E).contents,V=[];for(let E of Object.values(((v=P[r])==null?void 0:v.fields)??{})){let C=h(E.param),N=d(C),L=(k=N.validate)==null?void 0:k.call(N,N.data,{values:n,extraInfos:y});L&&(A(C,Z=>Object.assign({},Z,{error:L,touched:!0})),V.push({error:L,ancestors:E.param.ancestors,name:E.param.name,type:"field"}))}for(let E of Object.values(((j=P[r])==null?void 0:j.fieldArrays)??{})){let{errors:C}=G(r,E.param,d,{isValidation:!0,set:A,skipFieldCheck:!0});C!=null&&C.length&&V.push(...C)}return V},[r]),R=oe(x=>{x&&x.preventDefault&&x.preventDefault(),x&&x.stopPropagation&&x.stopPropagation();let{values:A,extraInfos:n}=b(),y=g(A,n),d=o==null?void 0:o(A);if(y.length||d!=null&&d.length){l&&l(y,d,A);return}c({isSubmitting:!0});let V=s==null?void 0:s(A,n);return V&&V.then?V.then(v=>{F.current&&(v!==!1&&p(e!=null&&e.reinitializeOnSubmit?t??{}:A,{skipUnregister:u,skipUnusedInitialValues:i},e!=null&&e.reinitializeOnSubmit?{}:n),c({isSubmitting:!1}))}).catch(()=>{F&&c({isSubmitting:!1})}):(c({isSubmitting:!1}),p(e!=null&&e.reinitializeOnSubmit?t??{}:A,{skipUnregister:u,skipUnusedInitialValues:i},e!=null&&e.reinitializeOnSubmit?{}:n),V)},[g,s,l,o,p,u,r,b]),w=oe(()=>{let{values:x,extraInfos:A}=b();return g(x,A)},[b,g]);return{handleSubmit:R,formState:a,handleReset:I,resetInitialValues:O,validateFields:S,validateAllFields:w,getValues:b}}function Re(e){return _.createElement(ge,null,e.children)}var $=_.createContext("");function we(e){var l,s,u;let t=X(((l=e==null?void 0:e.options)==null?void 0:l.formId)??ce());return z(()=>{let o=t.current;return()=>{delete P[o]}},[]),_.createElement(xe,{override:!((s=e.options)!=null&&s.skipRecoilRoot)},_.createElement($.Provider,{value:t.current},(u=e.options)!=null&&u.skipValuesObserver?null:_.createElement(be,null),_.createElement(Re,{...e})))}var Qe=(e,t)=>({...l})=>_.createElement(we,{options:t},_.createElement(e,{...l}));import Y from"react";var tt=e=>{let{children:t,name:l,required:s,handleChange:u,defaultValue:o,ancestors:i,validate:a}=e,{fieldValue:c,setFieldValue:r,error:f}=pe({name:l,ancestors:i,defaultValue:o,validate:a||(m=>s&&!m?"Required":null)}),F={value:c??"",onChange:m=>{var p;let I=(p=m==null?void 0:m.target)==null?void 0:p.value;r(I),u==null||u(I)},error:f};if(typeof t=="function")return Y.createElement(Y.Fragment,null,t({value:c??"",onChange:r,error:f}));{let m=Y.Children.map(t,I=>Y.isValidElement(I)?Y.cloneElement(I,F):I);return Y.createElement(Y.Fragment,null,m)}};export{tt as Field,we as FormProvider,pe as useField,He as useFieldArray,Oe as useFieldArrayColumnWatch,Ke as useFieldWatch,Je as useForm,_e as useFormContext,Ge as useFormValues,qe as useIsDirty,Qe as withFormProvider};
